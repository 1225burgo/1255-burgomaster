<html>
	<head>
		<title>
			My city
		</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<style type="text/css">
			/*canvas*/
			.canvas {
				left:0px;
				top:-6px;
				position:relative;
			}
			/*background*/
			.background {
				position:absolute;
				left:0px;
				top:0px;
				z-index:-1;
			}
			/*wall rear*/
			.over1 {
				position:absolute;
				left:0px;
				top:0px;
				z-index:1;
			}
			/*buildings*/
			.over2 {
				position:absolute;
				left:0px;
				top:0px;
				z-index:2;
			}
			/*wall front*/
			.over3 {
				position:absolute;
				left:0px;
				top:0px;
				z-index:3;
			}
			/*fire*/
			.fire {
				position:absolute;
				left:0px;
				top:0px;
				z-index:4;
			}
			.interface {
				position:absolute;
				left:0px;
				top:0px;
				z-index:99;
			}
			.resources{
				position: relative;
				left:0px;
			}
			#defence, #homes {
				width: 180px;
			}
			#console_n_chat {
				resize: none;
				overflow: auto;
			}
			/* Style the tab */
			div.tab {
				overflow: hidden;
				border: 1px solid #ccc;
				
				width: 800px;
			background-color: #f1f1f1;
			}

			/* Style the buttons inside the tab */
			div.tab button {
				background-color: inherit;
				float: left;
				border: none;
				outline: none;
				cursor: pointer;
				padding: 14px 16px;
				transition: 0.3s;
				font-size: 17px;
			}

			/* Change background color of buttons on hover */
			div.tab button:hover {
				background-color: #ddd;
			}

			/* Create an active/current tablink class */
				div.tab button.active {
				background-color: #ccc;
			}

			/* Style the tab content */
			.tabcontent {
				display: none;
				padding: 6px 0px;
				border: 1px solid #ccc;
				border-top: none;
				height: 470px;
				width: 800px;/*800-12*2*/
			}

			/* Style the close button */
			.topright {
				float: right;
				cursor: pointer;
				font-size: 20px;
			}

			.topright:hover {color: red;}
		</style>
		<script id="chatBroEmbedCode">
		/* Chatbro Widget Embed Code Start */
		function ChatbroLoader(chats,async) {async=async!==false;var params={embedChatsParameters:chats instanceof Array?chats:[chats],needLoadCode:typeof Chatbro==='undefined'};var xhr=new XMLHttpRequest();xhr.withCredentials = true;xhr.onload=function(){eval(xhr.responseText)};xhr.onerror=function(){console.error('Chatbro loading error')};xhr.open('POST','//www.chatbro.com/embed_chats/',async);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');xhr.send('parameters='+encodeURIComponent(JSON.stringify(params)))}
		/* Chatbro Widget Embed Code End */
		ChatbroLoader({encodedChatId: '1Leg'});
		</script>
	</head>
	<body>
	<a href="https://github.com/Areso/js-html5-mycity"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>
		<!--<span id="gold" class="interface" style="position:absolute; top:0px; left:60px">0</span>
		<span id="pop"  class="interface" style="position:absolute; top:0px; left:100px">2</span>-->
		<script>
		var url = window.location.pathname;
		var filename = url.substring(url.lastIndexOf('/')+1);
		
		if (filename == ""|| filename == "index.html" || filename =="index.htm" || filename =="index.php" || filename == "main2.html" || filename =="main.htm") {
			res_mod = "b";
		}
		else {
			res_mod = "b";
		}
		//alert(res_mod);
		/*
		function reload_res(this) {
		this.src=str.replace(\"_a\", res_mod);
		alert(this.src);
		}
		*/
		</script>
		<div class="tab">
			<button class="tablinks" onclick="openCity(event, 'Main')" id="defaultOpen">Main</button>
			<button class="tablinks" onclick="openCity(event, 'Explore')">Explore</button>
			<button class="tablinks" onclick="openCity(event, 'Settings')">Settings</button>
		</div>
		<div id="Main" class="tabcontent">
			<canvas width="800" height="480" id="canvas" class="canvas" style="z-index:-1"></canvas>
			<p style="position:absolute; top:60px; left: 20px">
		welcome to heroes' city
		</p>
			<br>
			<p id="resources">
			<span id="gold" class="interface" style="position:absolute; top:100px; left:60px">0</span>
			<br>
			<br>
			<span id="pop"  class="interface" style="position:absolute; top:140px; left:60px">2</span>
			<br>
		</p>
			<p id="constructions">
			
			</p>
			<img src="resources/fire_a.gif" id="fire" onclick="putOutFire()" style="position:absolute; top:170px; left:0px; z-index=98; display:none">
			<button id="defence" onclick="Build('Wall')" class="interface" style="top:170px; left:20px">Build walls: 2 gold</button>
			<button id="homes"   onclick="Build('Home')" class="interface" style="top:210px; left: 20px">Build home: 2 gold</button>
			<button id="saveGameButton"   onclick="saveGame()" class="interface" style="top:260px; left: 20px">Save game</button>
			<button id="loadGameButton"   onclick="loadGame()" class="interface" style="top:290px; left: 20px">Load game</button>
			<!--
			<iframe id="constructionWindow" src="construction.html" class="interface" style="left:600px" width="1" height="1"></iframe>
			<button id="constructionButton" onclick="maximizew('construction')" class="interface" style="top:260px">Open construction menu</button>
			-->
		</div>

		<div id="Explore" class="tabcontent">
			<!--<span onclick="this.parentElement.style.display='none'" class="topright">x</span>-->
			<h3>Explore</h3>
			<p>Global map</p> 
		</div>

		<div id="Settings" class="tabcontent">
			<!--<span onclick="this.parentElement.style.display='none'" class="topright">x</span>-->
			<h3>Settings</h3>
			<p>Alert / MSG to chat</p>
			<p>Autosave</p>
		</div>

		<p id="console_n_chat_div" style="top:530px; left:10px" class="interface">
		<textarea id="console_n_chat" name="console_n_chat" class="interface" value="" style="width:800px"></textarea>
		</p>
	<script>
		var canvas  = document.getElementById("canvas");
		var ctx     = canvas.getContext("2d");
		
		var img1    = loadImage('resources/background_a.png', composite);//use forward slashes for Linux and Windows compatible. \ this slash works only in Windows. 
		var img2    = loadImage('resources/sawmill_a.png', composite);
		var img3    = loadImage('resources/gold_a.png', composite);
		var img4    = loadImage('resources/pop_a.png', composite);
		var img5    = loadImage('resources/home_a.png', composite);
		var img5_1  = loadImage('resources/house_a.png', composite);
		var img6_1  = loadImage('resources/wallsr_a.png', composite);
		var img6_2  = loadImage('resources/wallsf_a.png', composite);
		var img7    = loadImage('resources/castle_a.png', composite);
		var img8    = loadImage('resources/wishing_well_builded.png', composite);
		
		var msg_pop_limit_en     = "your city is reached population limit. Build new houses or upgrade existing ones";
		var msg_pop_limit        = msg_pop_limit_en;
		var msg_game_saved_en    = "game saved successfully";
		var msg_game_saved       = msg_game_saved_en;
		var msg_game_loaded_en   = "game loaded successfully";
		var msg_game_loaded       = msg_game_loaded_en;

		var imagesLoaded = 0;
		
		function composite() {
			imagesLoaded = imagesLoaded*1 + 1;
			if (imagesLoaded > 1) {
				// composite now
				//ctx.globalAlpha = 1.00;
				ctx.drawImage(img1, 0, 0);   //draw background
				ctx.drawImage(img2, 0, 0);   //draw sawmill
				ctx.drawImage(img3, 10, 40); //draw gold icon
				ctx.drawImage(img4, 10, 80); //draw pop  icon
				ctx.drawImage(img8, 0, 0); //draw wishing well
				if (buildLevelD > 0) {
					// draw back piece of wall
					ctx.drawImage(img6_1, 0, 0);
				}
				if (buildLevelH > 0 && buildLevelH < 10) {
					// draw houses
					ctx.drawImage(img5, 0, 0);
				}
				if (buildLevelH > 10) {
					// draw more houses
					ctx.drawImage(img5_1, 0, 0);
				}
				if (buildLevelD > 1) {
					// draw castle
					ctx.drawImage(img7, 0, 0);
				}
				if (buildLevelD > 0) {
					// draw front piece of wall
					ctx.drawImage(img6_2, 0, 0);
				}	
			}
		}
		
		function loadImage(src, onload) {
			var img = new Image();
			img.onload = onload;
			img.src = src;
			return img;
		}
		//composite();
	</script>
	<script>
	//init variables
	var gold          = 20;
	var pop           = 2;
	var buildLevelD   = 0;
	var buildLevelH   = 0;
	//init const-variables
	var costWall      = 2;
	var costTower     = 4;
	var costHome      = 2;
	var lotteryPrize  = 50;
	//init service variables
	var redraw        = 0;
	var whatDraw      = "";
	var minBL         = 0;
	var fire          = 0;

	updateResources();
	//init timers
	setInterval(resourcesTimer, 30000);
	setInterval(rndEvents, 100000);
	setInterval(redrawTimer, 20);
	
	//functions
	function saveGame() {
		localStorage.setItem('gold', gold);
		localStorage.setItem('pop', pop);
		localStorage.setItem('buildLevelD', buildLevelD);
		localStorage.setItem('buildLevelH', buildLevelH);
		document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg_game_saved;
		scrollDown();
	}
	function loadGame() {
		gold = localStorage.getItem('gold');
		pop  = localStorage.getItem('pop');
		buildLevelD = localStorage.getItem('buildLevelD');
		buildLevelH = localStorage.getItem('buildLevelH');
		composite();
		updateResources();
		updateButtonCaptions();
		document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg_game_loaded;
		scrollDown();
	}
	function updateButtonCaptions(){
		nextLvl      = buildLevelH*1+1;
		nextLvlPrice = Math.pow(costHome,(buildLevelH*1+1));
		document.getElementById("homes").innerHTML="Build home lvl"+nextLvl+"; "+nextLvlPrice+" gold";

		if (buildLevelD === 1) {
			document.getElementById("defence").innerHTML="Build Tower: "+costTower+" gold";	
			var towerClick = "Build("+"\'Tower\'"+")";
			document.getElementById("defence").setAttribute("onclick", towerClick);
		}
		if (buildLevelD === 2) {
			document.getElementById("defence").setAttribute("style", "display:none");
		}
	}
	function getTime(type) {
	    var d = new Date();
	    var hh = d.getHours();
	    var mm = d.getMinutes();
	    var ss = d.getSeconds();
	    if (hh < 10) {
	    	hh = "0"+hh;
	    }
	    if (mm < 10) {
	    	mm = "0"+mm;
	    }
	    if (ss < 10) {
	    	ss = "0"+ss;
	    }
	    if (type=="0") {
	    	n = hh+":"+mm;	
	    }
	    if (type=="1") {
	    	n = hh+":"+mm+":"+ss;	
	    }
	    return n;
	}
	function scrollDown(){
   		var textarea = document.getElementById("console_n_chat");
		    if(textarea.selectionStart === textarea.selectionEnd) {
			textarea.scrollTop = textarea.scrollHeight;
	   		}
	}
	function updateResources() {
		document.getElementById("gold").innerHTML = gold;
		document.getElementById("pop").innerHTML  = pop;
	}
	function Build(Structure) {
		if (Structure==="Wall" || Structure ==="Tower") {
			if (gold >= costWall && buildLevelD == 0) { 
				buildLevelD = buildLevelD*1 + 1;
				gold = gold - costWall;
				redraw   = 1;
				whatDraw = "Wall";
				updateResources();
				return true;
			}
			if (gold >= costTower && buildLevelD == 1) { 
				buildLevelD = buildLevelD*1 + 1;
				gold = gold - costTower;
				redraw   = 1;
				whatDraw = "Tower";
				updateResources();
				return true;
			}
		}
		if (Structure==="Home") {
			if (gold >= Math.pow(costHome,(buildLevelH*1 + 1))) {
				gold = gold - Math.pow(costHome,(buildLevelH*1 + 1));
				redraw   = 1;
				whatDraw = "Home";
				buildLevelH = buildLevelH*1 + 1;
				updateResources();
				return true;
			}
		}
	}
	function Draw(Structure){
		if (Structure === "Wall"){
			composite();
			updateButtonCaptions();
		}
		if (Structure === "Tower"){
			composite();
			updateButtonCaptions();
		}
		if (Structure === "Home"){
			if (buildLevelH === 1) {
				composite();
			}
			updateButtonCaptions();
		}
		if (Structure === "House"){
			document.getElementById('constructions').innerHTML = document.getElementById('constructions').innerHTML+house;
			//update interface
			document.getElementById("homes").setAttribute("style", "display:none");
		}
	}
	function maximizew() {
		//var mxmw = document.getElementById("constructionWindow");
		document.getElementById("constructionWindow").setAttribute("width", 195);
		document.getElementById("constructionWindow").setAttribute("height", 400);
		
	}
	function minimizew() {
		//var mxmw = document.getElementById("constructionWindow");
		document.getElementById("constructionWindow").setAttribute("width", 1);
		document.getElementById("constructionWindow").setAttribute("height", 1);
	}
	function putOutFire () {
		if (fire === 1){
			var answer = confirm("Call an fireman? It will cost you 20 gold!");
			if (answer === true) {
				if (gold >= 20) {
					fire = 0;
					gold = gold - 20;
					document.getElementById("fire").setAttribute("style", "position:absolute; top:200px; left:200px; z-index=100; display:none");
					msg = "Fireman put out a fire!";
					document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg;
					scrollDown();
					updateResources();
				}
				else {
					msg = "We need more gold to do that!";
					document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg;
					scrollDown();
				}
			}
			else {
				msg = "it will burn to ashes!";
				document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg;
				scrollDown();
			}
		}
	}
	//timers
	function redrawTimer() {
		//cookies = document.cookie.split(';');
		//document.getElementById('dbg').innerHTML = minimizeBl;
		if (redraw === 1) {
			Draw(whatDraw);
			redraw = 0;
			whatDraw  = "";
		}
		if (minBL === 1) {
			minimizew();
			minBL=0;
		}
		return;
	}
	function resourcesTimer() {
		pop_m    = 0;
		gold     = gold*1+pop*1;
		//gold     = gold*1+2;
		if (pop < 2*Math.pow((buildLevelH*1+3),2)) {
			pop      = pop*1+1;
			pop_m    = 1;
		} else {
			document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg_pop_limit;
			scrollDown();
		}
		if (pop_m === 0) {
			msg   = "amount of money are increased!";
		}
		if (pop_m === 1) {
			msg   = "population and amount of money are increased!";
		}
		document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg;
		scrollDown();
		updateResources();
	}
	function rndEvents() {
		rnd = Math.floor((Math.random() * 12) + 1);
		//rnd = 2;
		switch (rnd) {
			case 1:
				msg = "shit happens";
				document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg;
				scrollDown();
				//alert("shit happens");
				break;
			case 2:
				if (fire === 0) {
					msg = "fire in the city!";
					document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg;
					scrollDown();
					//alert('fire in the city!');
					document.getElementById("fire").setAttribute("style", "position:absolute; top:170px; left:0px; z-index=98; display:true");
					fire = 1;
					//var fire_img = "<img src=\"1.png\" class=\"over1\">";
					//document.getElementById('constructions').innerHTML = document.getElementById('constructions').innerHTML+wall;
					if (buildLevelD == 1) {
						ceil = 1
					}
					if (buildLevelD == 2) {
						ceil = 2
					}
					rnd = Math.floor((Math.random() * 2) + 0);
					if (rnd === 0) {
					//	document.getElementById('constructions').innerHTML = document.getElementById('constructions').innerHTML+fire;
					}
					if (rnd === 1) {
					//	document.getElementById('constructions').innerHTML = document.getElementById('constructions').innerHTML+fire;
					}
					if (rnd === 0) {
					//	document.getElementById('constructions').innerHTML = document.getElementById('constructions').innerHTML+fire;
					}
				}
				break;
			case 3:
				//
				break;
			case 4:
				//
				break;
			case 5:
				//
				break;
			case 6:
				//
				break;
			case 7:
				//
				break;
			case 8:
				//
				break;
			case 9:
				//
				break;
			case 10:
				//
				break;
			case 11:
				//
				break;
			case 12:
				msg = "shit happens";
				document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg;
				scrollDown();
				//alert("You won a lottery with "+lotteryPrize+" gold prize");
				gold = gold + lotteryPrize;
				updateResources();
				break;
			default:
				alert("error on switch/case function");
		}
	}
	</script>
	<script>
	function openCity(evt, cityName) {
		var i, tabcontent, tablinks;
		tabcontent = document.getElementsByClassName("tabcontent");
		for (i = 0; i < tabcontent.length; i++) {
			tabcontent[i].style.display = "none";
		}
		tablinks = document.getElementsByClassName("tablinks");
		for (i = 0; i < tablinks.length; i++) {
			tablinks[i].className = tablinks[i].className.replace(" active", "");
		}
		document.getElementById(cityName).style.display = "block";
		evt.currentTarget.className += " active";
	}
	// Get the element with id="defaultOpen" and click on it
	document.getElementById("defaultOpen").click();
	</script>
	</body>
</html>