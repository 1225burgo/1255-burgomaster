<html>
	<head>
		<title>
			Walled Town
		</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<style type="text/css">
			/*canvas*/
			.canvas {
				left:0px;
				top:-6px;
				position:relative;
			}
			/*background*/
			.background {
				position:absolute;
				left:0px;
				top:0px;
				z-index:-1;
			}
			/*wall rear*/
			.over1 {
				position:absolute;
				left:0px;
				top:0px;
				z-index:1;
			}
			/*buildings*/
			.over2 {
				position:absolute;
				left:0px;
				top:0px;
				z-index:2;
			}
			/*wall front*/
			.over3 {
				position:absolute;
				left:0px;
				top:0px;
				z-index:3;
			}
			/*fire*/
			.fire {
				position:absolute;
				left:0px;
				top:0px;
				z-index:4;
			}
			.interface {
				position:absolute;
				left:0px;
				top:0px;
				z-index:99;
			}
			.resources{
				position: relative;
				left:0px;
			}
			#defence, #homes, #treasury {
				width: 180px;
			}
			#buttonBldGallows, #buttonBldFountain, #buttonBldStash {
				width: 180px;
			}
			#console_n_chat {
				resize: none;
				overflow: auto;
			}
			/* Style the tab */
			div.tab {
				overflow: hidden;
				border: 1px solid #ccc;
				
				width: 800px;
			background-color: #f1f1f1;
			}

			/* Style the buttons inside the tab */
			div.tab button {
				background-color: inherit;
				float: left;
				border: none;
				outline: none;
				cursor: pointer;
				padding: 14px 16px;
				transition: 0.3s;
				font-size: 17px;
			}

			/* Change background color of buttons on hover */
			div.tab button:hover {
				background-color: #ddd;
			}

			/* Create an active/current tablink class */
				div.tab button.active {
				background-color: #ccc;
			}

			/* Style the tab content */
			.tabcontent {
				display: none;
				padding: 6px 0px;
				border: 1px solid #ccc;
				border-top: none;
				height: 470px;
				width: 800px;/*800-12*2*/
			}

			/* Style the close button */
			.topright {
				float: right;
				cursor: pointer;
				font-size: 20px;
			}

			.topright:hover {color: red;}
		</style>
		<script id="chatBroEmbedCode">
		/* Chatbro Widget Embed Code Start */
		function ChatbroLoader(chats,async) {async=async!==false;var params={embedChatsParameters:chats instanceof Array?chats:[chats],needLoadCode:typeof Chatbro==='undefined'};var xhr=new XMLHttpRequest();xhr.withCredentials = true;xhr.onload=function(){eval(xhr.responseText)};xhr.onerror=function(){console.error('Chatbro loading error')};xhr.open('POST','//www.chatbro.com/embed_chats/',async);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');xhr.send('parameters='+encodeURIComponent(JSON.stringify(params)))}
		/* Chatbro Widget Embed Code End */
		ChatbroLoader({encodedChatId: '1Leg'});
		</script>
	</head>
	<body>
		<a href="https://github.com/Areso/js-html-mycity"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>
		<!--<span id="gold" class="interface" style="position:absolute; top:0px; left:60px">0</span>
		<span id="pop"  class="interface" style="position:absolute; top:0px; left:100px">2</span>-->
		<script>
		var url = window.location.pathname;
		var filename = url.substring(url.lastIndexOf('/')+1);
		
		if (filename == ""|| filename == "index.html" || filename =="index.htm" || filename =="index.php" || filename == "main2.html" || filename =="main.htm") {
			res_mod = "b";
		}
		else {
			res_mod = "b";
		}
		//alert(res_mod);
		/*
		function reload_res(this) {
		this.src=str.replace(\"_a\", res_mod);
		alert(this.src);
		}
		*/
		</script>
		<div class="tab">
			<button class="tablinks" onclick="openCity(event, 'Main')" id="defaultOpen">Main</button>
			<button class="tablinks" onclick="openCity(event, 'Explore')">Explore</button>
			<button class="tablinks" onclick="openCity(event, 'Settings')">Settings</button>
			<button class="tablinks" onclick="openCity(event, 'Garrison')">Garrison</button>
			<button class="tablinks" onclick="openCity(event, 'Building')">Building</button>
		</div>
		<div id="Main" class="tabcontent">
			<canvas width="800" height="480" id="canvas" class="canvas" style="z-index:-1"></canvas>
			<p style="position:absolute; top:60px; left: 20px">
			welcome to heroes' city
			</p>
			<br>
			<p id="resources">
			<span id="gold" class="interface" onclick="hireTreasuryGuard()" style="position:absolute; top:100px; left:60px">0</span>
			<br>
			<br>
			<span id="pop"  class="interface" style="position:absolute; top:140px; left:60px">2</span>
			<br>
		</p>
			<p id="constructions">
			
			</p>
			<img src="resources/fire_a.gif" id="fire" onclick="putOutFire()" style="position:absolute; top:170px; left:0px; z-index=98; display:none">
			
			<button id="saveGameButton"   onclick="saveGame()" class="interface" style="top:290px; left: 20px">Save game</button>
			<button id="loadGameButton"   onclick="loadGame()" class="interface" style="top:350px; left: 20px">Load game</button>
			<button id="putOutFire"   onclick="putOutFire()" class="interface" style="top:390px; left: 20px; display:none">Put out fire</button>
			<!--
			<iframe id="constructionWindow" src="construction.html" class="interface" style="left:600px" width="1" height="1"></iframe>
			<button id="constructionButton" onclick="maximizew('construction')" class="interface" style="top:260px">Open construction menu</button>
			-->
		</div>

		<div id="Explore" class="tabcontent">
			<canvas width="800" height="480" id="canvasMap" class="canvas" style="z-index:-1"></canvas>
			<p style="position:absolute; top:60px; left: 20px">
			GLOBALMAP
			</p> 
		</div>

		<div id="Settings" class="tabcontent">
			<!--<span onclick="this.parentElement.style.display='none'" class="topright">x</span>-->
			<h3>Settings</h3>
			<p>Alert / MSG to chat</p>
			<table>
			<tr>
				<td>Autosave <img id="autosaveImg" onclick="changeAutosave()" src="resources/button_red.png"></td>
				</tr>
			</table>
			
			<textarea id="patchnotes" class="interface" value="" style="width:700px; height:300px; top:200px; left:40px"></textarea>
			
		</div>
		
		<div id="Garrison" class="tabcontent">
			<!--<span onclick="this.parentElement.style.display='none'" class="topright">x</span>-->
			<h3>Garrison</h3>
			<div id="divtreasuryGuard">
			<table border="1">
				<tr>
					<td>
						<div align="center">
							<img src="resources/knight6.png">
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<button id="fireGuard" onclick="fireTreasuryGuard()" style="width:80px">Fire</button>
						<span id="treasuryGuard">0</span>
						<button id="hireGuard" onclick="hireTreasuryGuard()" style="width:80px">Hire</button>
						<!--<button id="fireGuard" onclick="fireTreasuryGuard()" class="interface" style="top:170px; left:20px; width:80px">Fire</button>
						<span id="treasuryGuard" class="interface" style="position:absolute; top:170px; left:120px">0</span>
						<button id="hireGuard" onclick="hireTreasuryGuard()" class="interface" style="top:170px; left:180px;-->
					</td>
				</tr>
			</table>
			</div>
		</div>
		
		<div id="Building" class="tabcontent">
			<!--<span onclick="this.parentElement.style.display='none'" class="topright">x</span>-->
			<h3>Building</h3>
			<div>
				<table border="1">
				<tr>
					<td>
						<div align="center">
							<img id="defencies_img" src="resources/wallsf_as2.png">
						</div>
					</td>
					<td>
						<div align="center">
							<img src="resources/home_as.png">
						</div>
					</td>
					<td>
						<div align="center">
							<img src="resources/treasury_as.png">
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<button id="defence" onclick="Build('Wall')">Build walls: 2 gold</button>
					</td>
					<td>
						<button id="homes" onclick="Build('Home')">Build home: 2 gold</button>
					</td>
					<td>
						<button id="treasury" onclick="Build('Treasury')">Build treasury: 20 gold</button>
					</td>
					<!--
					<button id="defence" onclick="Build('Wall')" class="interface" style="top:170px; left:20px">Build walls: 2 gold</button>
					<button id="homes"   onclick="Build('Home')" class="interface" style="top:210px; left: 20px">Build home: 2 gold</button>
					<button id="treasury" onclick="Build('Treasury')" class="interface" style="top:250px; left:20px">Build treasury: 20 gold</button>-->
				</tr>
				<tr>
					<td>
						<div align="center">
							<img src="resources/gallows.png">
						</div>
					</td>
					<td>
						<div align="center">
							<img src="resources/fountain.png">
						</div>
					</td>
					<td>
						<div align="center">
							<img src="resources/trapdoor.png">
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<button id="buttonBldGallows" onclick="Build('Gallows')">Build gallows: 50 gold</button>
					</td>
					<td>
						<button id="buttonBldFountain" onclick="Build('Fountain')">Build fountain: 50 gold</button>
					</td>
					<td>
						<button id="buttonBldStash" onclick="Build('Stash')">Build stash: 50 gold</button>
					</td>
				</tr>
			</table>
			</div>
		</div>

		<p id="console_n_chat_div" style="top:530px; left:10px" class="interface">
		<textarea id="console_n_chat" name="console_n_chat" class="interface" value="" style="width:800px"></textarea>
		</p>
	<script>
	//TOWN
		var canvas  = document.getElementById("canvas");
		var ctx     = canvas.getContext("2d");
		
		var img1    = loadImage('resources/background_a.png', composite);//use forward slashes for Linux and Windows compatible. \ this slash works only in Windows. 
		var img2    = loadImage('resources/sawmill_a.png', composite);
		var img3    = loadImage('resources/gold_a.png', composite);
		var img4    = loadImage('resources/pop_a.png', composite);
		var img5    = loadImage('resources/home_a.png', composite);
		var img5_1  = loadImage('resources/house_a.png', composite);
		var img6_1  = loadImage('resources/wallsr_a.png', composite);
		var img6_2  = loadImage('resources/wallsf_a.png', composite);
		var img7    = loadImage('resources/castle_as.png', composite);
		var img8    = loadImage('resources/wishing_well_builded.png', composite);
		var img9    = loadImage('resources/treasury.png', composite);
		var img10   = loadImage('resources/gallows.png', composite);
		var img11   = loadImage('resources/fountain.png', composite);
		var img12   = loadImage('resources/trapdoor.png', composite);
		
		var msg_pop_limit_en     = "your city is reached population limit. Build new houses or upgrade existing ones";
		var msg_pop_limit        = msg_pop_limit_en;
		var msg_game_saved_en    = "game saved successfully";
		var msg_game_saved       = msg_game_saved_en;
		var msg_game_loaded_en   = "game loaded successfully";
		var msg_game_loaded      = msg_game_loaded_en;
		
		var imagesLoaded = 0;
		
		function composite() {
			imagesLoaded = imagesLoaded*1 + 1;
			if (imagesLoaded > 1) {
				// composite now
				//ctx.globalAlpha = 1.00;
				ctx.drawImage(img1, 0, 0);   //draw background
				ctx.drawImage(img2, 0, 0);   //draw sawmill
				ctx.drawImage(img3, 10, 40); //draw gold icon
				ctx.drawImage(img4, 10, 80); //draw pop  icon
				ctx.drawImage(img8, 0, 0); //draw wishing well
				if (buildLevelD > 0) {
					// draw back piece of wall
					ctx.drawImage(img6_1, 0, 0);
				}
				if (buildLevelH > 0 && buildLevelH < 10) {
					// draw houses
					ctx.drawImage(img5, 0, 0);
				}
				if (buildLevelH > 10) {
					// draw more houses
					ctx.drawImage(img5_1, 0, 0);
				}
				if (buildLevelD > 1) {
					// draw castle
					ctx.drawImage(img7, 300, 160);
				}
				if (buildLevelD > 0) {
					// draw front piece of wall
					ctx.drawImage(img6_2, 0, 0);
				}
				if (buildLevelTreasury > 0) {
					// draw treasury
					ctx.drawImage(img9, 0, 0);
				}
				if (buildLevelGallows > 0) {
					// draw gallows
					ctx.drawImage(img10, 460, 270);
				}
				if (buildLevelFountain > 0) {
					// draw fountain
					ctx.drawImage(img11, 460, 270);
				}
				if (buildLevelStash > 0) {
					// draw stash
					//We do not draw a secret Stash under the Treasury. It's a secret, are you understand?!
					//ctx.drawImage(img12, 0, 0);
				}
			}
		}
		
		function loadImage(src, onload) {
			var img = new Image();
			img.onload = onload;
			img.src = src;
			return img;
		}
		//composite();
	</script>
	
	<script>
	
	//GLOBALMAP
		var canvas_map      = document.getElementById("canvasMap");
		var ctx_map         = canvas_map.getContext("2d");
		var tile_grass      = loadImage('tiles/grass.png', composite_gm);//use forward slashes for Linux and Windows compatible. \ this slash works only in Windows. 
		var tile_sand       = loadImage('tiles/sand.png', composite_gm);
		var tile_snow       = loadImage('tiles/snow.png', composite_gm);
		var tile_water      = loadImage('tiles/water.png', composite_gm);
		
		var imagesLoadedMap = 0;
		
		function composite_gm() {
			imagesLoadedMap = imagesLoadedMap*1 + 1;
			if (imagesLoadedMap > 1) {
				// composite now
				//ctx.globalAlpha = 1.00;
				for (i = 0; i < 4; i++) {
					for (j = 0; j < 4; j++) {
						globalMap[0][0] = 1;
					}
				}
				ctx_map.drawImage(tile_grass, 0, 0);   //draw background
				
			}
		}
		/*
		function loadImage(src, onload) {
			var img = new Image();
			img.onload = onload;
			img.src = src;
			return img;
		}
		*/
	</script>
	<script>
	//init variables
	var gold          = 20;
	var pop           = 2;
	var buildLevelD   = 0;
	var buildLevelH   = 0;
	var buildLevelTreasury = 0;
	var buildLevelGallows  = 0;
	var buildLevelFountain = 0;
	var buildLevelStash    = 0;
	var fire          = 0;
	var autosave      = 0;
	var happyness     = 0;
	//init const-variables
	var costWall      = 2;
	var costTower     = 4;
	var costHome      = 2;
	var costTreasury  = 20;
	var costGallows   = 50;
	var costFountain  = 50;
	var costStash     = 50;
	var lotteryPrize  = 50;
	var treasuryGuardPriceHire = 20;
	var treasuryGuardPricePayroll = 20;
	//init service variables
	var redraw        = 0;
	var whatDraw      = "";
	var minBL         = 0;
	var treasuryGuard = 0;
	var mapCreated    = 0;
	var globalMap = [[],[]];
	updateResources();
	populatePatchnotes();
	generateMap();
	var autosaveObject;
	setupAutosave();
	//init timers
	setInterval(resourcesTimer, 30000);
	setInterval(rndEvents, 100000);
	
	
	
	//functions
	
	function generateMap() {
		/*
		var arr  = [];
		
		var arr1 = ['00','01'];
		var arr2 = ['10','11'];
		var arr3 = ['20','21'];
		for (j = 0; j < 2; j++) {
				arr1.push(Math.floor(Math.random()*10); 
			} 
		arr.push(arr1);
		arr.push(arr2);
		arr.push(arr3);
		for (i = 0; i < 4; i++) {
			for (j = 0; j < 4; j++) {
				globalMap[0][0] = 1; 
			}
		}
		*/
		for (var a=[]; a.push([])<10;);
		for (i = 0; i < 4; i++) {
			for (j = 0; j < 4; j++) {
				a[i][j] = Math.floor(Math.random()*10); 
				console.log("i "+i+" and j is "+j+" value is "+a[i][j]);
			}
		}
	mapCreated = 1;
	}
	
	function populatePatchnotes() {
	msg = "version 1.0.79";
	writeToTextArea(msg);
	msg = "gallows prevent building fountain, fountain prevent building gallows and stash requires treasury";
	writeToTextArea(msg);
	msg = "version 1.0.78";
	writeToTextArea(msg);
	msg = "bugfix #34 Autosave now implemented"+"\n"+
		"bugfix #59 new variables don't brick old saves";
	writeToTextArea(msg);
	msg = "version 1.0.76";
	writeToTextArea(msg);
	msg = "bugfix #39 Save/Load doesn't apply on fire in the city"+"\n"+
		"bugfix #42 Prevent load game if there no saves around"+"\n"+
		"bugfix #51 Save and Load with confirmation"+"\n"+
		"bugfix #54 Hiring treasury guards available only if treasury is built"+"\n"+
		"close #55 Added image of treasury guard";
	writeToTextArea(msg);
	
	msg = "version 1.0.72";
	writeToTextArea(msg);
	msg = "bugfix #29, #47, #48. No defence button after load"
	writeToTextArea(msg);
	
	msg = "version 1.0.70";
	writeToTextArea(msg);
	msg = "bugfix #44. Now it indicates if gold increased, decreased or not changed"
	writeToTextArea(msg);
	
	msg = "version 1.0.69";
	writeToTextArea(msg);
	msg = "bugfix #43 (word 'gold' appears after variable, when thieves stole some gold. fix #40"
	writeToTextArea(msg);
	
	msg = "version 1.0.68";
	writeToTextArea(msg);
	msg = "Bug fixes #35";
	writeToTextArea(msg);
	
	msg = "version 1.0.66";
	writeToTextArea(msg);
	msg = "You now can fire guardsmen"
	writeToTextArea(msg);
	
	msg = "version 1.0.65";
	writeToTextArea(msg);
	msg = "Bug fix #30. You're need to hire your treasury guards again, because save file is partially broken"
	writeToTextArea(msg);
	
	msg = "version 1.0.64";
	writeToTextArea(msg);
	msg = "Added new tab 'Building'. All building buttons move to 'Building' tab. Added firing procedure for treasury guardsmen (not only hiring for now). Added treasury building. As for now it does nothing, but it exists now."
	writeToTextArea(msg);
	}
	function writeToTextArea(msg) {
		document.getElementById("patchnotes").value = document.getElementById("patchnotes").value+"\r\n"+msg;
	}
	function setupAutosave() {
		if (autosave==0) {
			if (typeof autosaveObject !== 'undefined') {
			clearInterval(autosaveObject);
			}
			//alert("Autosave disabled");
			document.getElementById("autosaveImg").setAttribute("src","resources/button_red.png");
		} else {
			autosaveObject = setInterval(autosaveGame, 40000);
			//alert("Autosave enabled");
			document.getElementById("autosaveImg").setAttribute("src","resources/button_green.png");
		}
	}
	function changeAutosave() {
		if (autosave==0) {
			autosave = 1;
			setupAutosave();
		} else {
			autosave = 0;
			setupAutosave();
		}
	}
	function autosaveGame() {
		//alert("saved");
		saveGame("silent");
	}
	function saveGame(saveConfirmation) {
		if (saveConfirmation=="silent") { 
			writeSave();
		} else {
			var answer = confirm("Save game? It will rewrite any save you already have!");
			if (answer === true) {
				writeSave();
			}
		}
	}
	function writeSave(){
			localStorage.setItem('gold', gold);
			localStorage.setItem('pop', pop);
			localStorage.setItem('buildLevelD', buildLevelD);
			localStorage.setItem('buildLevelH', buildLevelH);
			localStorage.setItem('treasuryGuard', treasuryGuard);
			localStorage.setItem('buildLevelTreasury', buildLevelTreasury);
			localStorage.setItem('buildLevelGallows', buildLevelGallows);
			localStorage.setItem('buildLevelFountain', buildLevelFountain);
			localStorage.setItem('buildLevelStash', buildLevelStash);
			localStorage.setItem('fire', fire);
			localStorage.setItem('autosave', autosave);
			localStorage.setItem('happyness', happyness);
			document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg_game_saved;
			scrollDown();
	}
	function loadGame() {
		var answer = confirm("Load game? It will lost any progress since last save!");
		if (answer === true) {
			if (localStorage.getItem('gold')!=null){
				gold = localStorage.getItem('gold');
				pop  = localStorage.getItem('pop');
				if (localStorage.getItem('buildLevelD')!=null){
					buildLevelD          = localStorage.getItem('buildLevelD');
				} else {
					buildLevelD          = 0;
				}
				if (localStorage.getItem('buildLevelH')!=null){
					buildLevelH          = localStorage.getItem('buildLevelH');
				} else {
					buildLevelH          = 0;
				}
				if (localStorage.getItem('treasuryGuard')!=null){
					treasuryGuard        = localStorage.getItem('treasuryGuard');
				} else {
					treasuryGuard        = 0;
				}
				if (localStorage.getItem('buildLevelTreasury')!=null){
					buildLevelTreasury   = localStorage.getItem('buildLevelTreasury');
				} else {
					buildLevelTreasury   = 0;
				}
				if (localStorage.getItem('buildLevelGallows')!=null){
					buildLevelGallows    = localStorage.getItem('buildLevelGallows');
				} else {
					buildLevelGallows    = 0;
				}
				if (localStorage.getItem('buildLevelFountain')!=null){
					buildLevelFountain   = localStorage.getItem('buildLevelFountain');
				} else {
					buildLevelFountain   = 0;
				}
				if (localStorage.getItem('buildLevelStash')!=null){
					buildLevelTreasury   = localStorage.getItem('buildLevelStash');
				} else {
					buildLevelTreasury   = 0;
				}
				if (localStorage.getItem('fire')!=null){
					fire   = localStorage.getItem('fire');
				} else {
					fire = 0;
				}
				if (localStorage.getItem('autosave')!=null){
					autosave   = localStorage.getItem('autosave');
				} else {
					autosave           = 0;
				}
				if (localStorage.getItem('happyness')!=null){
					happyness   = localStorage.getItem('happyness');
				} else {
					happyness          = 80;
				}
				setupAutosave();
				composite();
				updateResources();
				updateButtonCaptions();
				document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg_game_loaded;
				scrollDown();
			} else {
				alert('Sorry! There are no save to load!');
			}
		}
	}
	function updateButtonCaptions(){
		nextLvlHome      = buildLevelH*1+1;
		nextLvlPriceHome = Math.pow(costHome,(buildLevelH*1+1));
		document.getElementById("homes").innerHTML="Build home lvl"+nextLvlHome+"; "+nextLvlPriceHome+" gold";
		nextLvlTreasury  = buildLevelTreasury*1+1;
		nextLvlPriceTreasury = Math.pow(costTreasury,(buildLevelTreasury*1+1));
		document.getElementById("treasury").innerHTML="Build treasury lvl"+nextLvlTreasury+"; "+nextLvlPriceTreasury+" gold";
		if (buildLevelD == 1) {
			document.getElementById("defence").innerHTML="Build Tower: "+costTower+" gold";	
			var towerClick = "Build("+"\'Tower\'"+")";
			document.getElementById("defence").setAttribute("onclick", towerClick);
		}
		if (buildLevelD == 2) {
			document.getElementById("defence").setAttribute("style", "display:none");
		}
	}
	function getTime(type) {
		var d = new Date();
		var hh = d.getHours();
		var mm = d.getMinutes();
		var ss = d.getSeconds();
		if (hh < 10) {
			hh = "0"+hh;
		}
		if (mm < 10) {
			mm = "0"+mm;
		}
		if (ss < 10) {
			ss = "0"+ss;
		}
		if (type=="0") {
			n = hh+":"+mm;	
		}
		if (type=="1") {
			n = hh+":"+mm+":"+ss;	
		}
		return n;
	}
	function scrollDown(){
		var textarea = document.getElementById("console_n_chat");
			if(textarea.selectionStart === textarea.selectionEnd) {
			textarea.scrollTop = textarea.scrollHeight;
			}
	}
	function updateResources() {
		document.getElementById("gold").innerHTML = gold;
		document.getElementById("pop").innerHTML  = pop;
		document.getElementById("treasuryGuard").innerHTML = treasuryGuard;
	}
	function Build(Structure) {
		if (Structure==="Wall" || Structure ==="Tower") {
			if (gold >= costWall && buildLevelD == 0) { 
				buildLevelD = buildLevelD*1 + 1;
				gold = gold - costWall;
				updateResources();
				composite();
				updateButtonCaptions();
				return true;
			}
			if (gold >= costTower && buildLevelD == 1) { 
				buildLevelD = buildLevelD*1 + 1;
				gold = gold - costTower;
				updateResources();
				composite();
				updateButtonCaptions();
				return true;
			}
		}
		if (Structure==="Home") {
			if (gold >= Math.pow(costHome,(buildLevelH*1 + 1))) {
				gold = gold - Math.pow(costHome,(buildLevelH*1 + 1));
				buildLevelH = buildLevelH*1 + 1;
				updateResources();
				composite();
				updateButtonCaptions();
				return true;
			}
		}
		if (Structure==="Treasury") {
			if (gold >= Math.pow(costTreasury,(buildLevelTreasury*1 + 1))) {
				gold = gold - Math.pow(costTreasury,(buildLevelTreasury*1 + 1));
				buildLevelTreasury = buildLevelTreasury*1 + 1;
				updateResources();
				composite();
				updateButtonCaptions();
				return true;
			}
		}
		if (Structure==="Gallows") {
			if (gold >= Math.pow(costGallows,(buildLevelGallows*1 + 1)) && buildLevelFountain == 0) {
				gold = gold - Math.pow(costGallows,(buildLevelGallows*1 + 1));
				buildLevelGallows = buildLevelGallows*1 + 1;
				updateResources();
				composite();
				updateButtonCaptions();
				return true;
			}
		}
		if (Structure==="Fountain") {
			if (gold >= Math.pow(costFountain,(buildLevelFountain*1 + 1)) && buildLevelGallows == 0) {
				gold = gold - Math.pow(costFountain,(buildLevelFountain*1 + 1));
				buildLevelFountain = buildLevelFountain*1 + 1;
				updateResources();
				composite();
				updateButtonCaptions();
				return true;
			}
		}
		if (Structure==="Stash") {
			if (gold >= Math.pow(costStash,(buildLevelStash*1 + 1)) && buildLevelTreasury*1 > 0) {
				gold = gold - Math.pow(costStash,(buildLevelStash*1 + 1));
				buildLevelStash = buildLevelStash*1 + 1;
				updateResources();
				composite();
				updateButtonCaptions();
				return true;
			}
		}
	}
	/*
	function maximizew() {
		//var mxmw = document.getElementById("constructionWindow");
		document.getElementById("constructionWindow").setAttribute("width", 195);
		document.getElementById("constructionWindow").setAttribute("height", 400);
		
	}
	function minimizew() {
		//var mxmw = document.getElementById("constructionWindow");
		document.getElementById("constructionWindow").setAttribute("width", 1);
		document.getElementById("constructionWindow").setAttribute("height", 1);
	}
	*/
	function putOutFire () {
		if (fire === 1){
			var answer = confirm("Call an fireman? It will cost you 20 gold!");
			if (answer === true) {
				if (gold >= 20) {
					fire = 0;
					gold = gold - 20;
					document.getElementById("fire").setAttribute("style", "position:absolute; top:200px; left:200px; z-index=100; display:none");
					msg = "Fireman put out a fire!";
					document.getElementById("putOutFire").setAttribute("style", "top:390px; left: 20px; display:none");
					document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg;
					scrollDown();
					updateResources();
				}
				else {
					msg = "We need more gold to do that!";
					document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg;
					scrollDown();
				}
			}
			else {
				msg = "it will burn to ashes!";
				document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg;
				scrollDown();
			}
		}
	}
	function hireTreasuryGuard() {
		if (buildLevelTreasury >= 1) {
			var answer = confirm("Hire a guardman? It will cost you 20 gold per tick!");
			if (answer === true) {
				if (gold >= treasuryGuardPriceHire) {
					treasuryGuard = treasuryGuard*1 + 1;
					gold = gold - treasuryGuardPriceHire;
					//document.getElementById("guardmen").setAttribute("style", "position:absolute; top:200px; left:200px; z-index=100; display:true");
					msg = "You are hired a guardman!";
					document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg;
					scrollDown();
					updateResources();
				}
				else {
					msg = "We need more gold to do that!";
					document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg;
					scrollDown();
				}
			}
		} else {
			alert('You don\'t have a treasury to hire a treasury guard!');
		}
	}
	function fireTreasuryGuard() {
		if (treasuryGuard > 0) {
			var answer = confirm("Fire a guardman?");
			if (answer === true) {
				treasuryGuard = treasuryGuard*1 - 1;
				msg = "You are fired a guardman!";
				document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg;
				scrollDown();
				updateResources();
			}
		} else {
			msg = "You don't have any guardsmen!";
			document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg;
			scrollDown();
		}		
	}
	//timers
	function resourcesTimer() {
		pop_m    = 0;
		gold_was = gold;
		gold     = gold*1+Math.round(pop*(1+buildLevelGallows*1/10),0);
		//gold     = gold*1+2;
		if (pop < 2*Math.pow((buildLevelH*1+3),2)) {
			pop      = Math.round((pop*1+pop*1*20/1000)*(1+buildLevelFountain*1/10),0);
			pop_m    = 1;
		} else {
			document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg_pop_limit;
			scrollDown();
		}
		if (treasuryGuard > 0) {
			if (gold - treasuryGuard * treasuryGuardPricePayroll >= 0) {
				gold = gold - treasuryGuard * treasuryGuardPricePayroll;
			}
			else {
			//fire guards which we cannot afford
			//for now fire all guards!
				treasuryGuard = 0;
				msg   = "treasury guard(s) were fired because you are cannot pay to them!";
				document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg;
				scrollDown();
			}
		}
		if (gold > gold_was) {
			msg_gold = "increased";
		} else {
			if (gold === gold_was) {
				msg_gold = "not changed"
			} else {
				msg_gold = "decreased"
			}
		}
		if (pop_m === 0) {
			msg   = "amount of money are "+msg_gold;
		}
		if (pop_m === 1) {
			msg   = "population increased and amount of money are "+msg_gold;
		}
		document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg;
		scrollDown();
		updateResources();
	}
	function rndEvents() {
		rnd = Math.floor((Math.random() * 12) + 1);
		//rnd = 1;//debug
		switch (rnd) {
			case 1:
				rndThieves = Math.floor((Math.random() * treasuryGuard) + 1); 
				if (rndThieves === 1) {
					goldLost = Math.floor(Math.random() * (gold/(1+buildLevelTreasury))  + 1);//where is 5 is Stash Level //todo
					gold     = gold - goldLost;
					msg = "shit happens: thieves stole "+goldLost+" gold from your treasury";
					document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg;
					updateResources();
					scrollDown();
					//alert("shit happens");
				}
				break;
			case 2:
				if (fire === 0) {
					msg = "fire in the city!";
					document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg;
					scrollDown();
					//alert('fire in the city!');
					document.getElementById("putOutFire").setAttribute("style", "top:390px; left: 20px; display:true");
					document.getElementById("fire").setAttribute("style", "position:absolute; top:170px; left:0px; z-index=98; display:true");
					fire = 1;
					//var fire_img = "<img src=\"1.png\" class=\"over1\">";
					//document.getElementById('constructions').innerHTML = document.getElementById('constructions').innerHTML+wall;
					if (buildLevelD == 1) {
						ceil = 1
					}
					if (buildLevelD == 2) {
						ceil = 2
					}
					rnd = Math.floor((Math.random() * 2) + 0);
					if (rnd === 0) {
					//	document.getElementById('constructions').innerHTML = document.getElementById('constructions').innerHTML+fire;
					}
					if (rnd === 1) {
					//	document.getElementById('constructions').innerHTML = document.getElementById('constructions').innerHTML+fire;
					}
					if (rnd === 0) {
					//	document.getElementById('constructions').innerHTML = document.getElementById('constructions').innerHTML+fire;
					}
				}
				break;
			case 3:
				//
				break;
			case 4:
				//
				break;
			case 5:
				//
				break;
			case 6:
				//
				break;
			case 7:
				//
				break;
			case 8:
				//
				break;
			case 9:
				//
				break;
			case 10:
				//
				break;
			case 11:
				//
				break;
			case 12:
				msg = "You won a lottery with "+lotteryPrize+" gold prize";
				document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msg;
				scrollDown();
				//alert("You won a lottery with "+lotteryPrize+" gold prize");
				gold = gold + lotteryPrize;
				updateResources();
				break;
			default:
				alert("error on switch/case function");
		}
	}
	</script>
	<script>
	function openCity(evt, cityName) {
		var i, tabcontent, tablinks;
		tabcontent = document.getElementsByClassName("tabcontent");
		for (i = 0; i < tabcontent.length; i++) {
			tabcontent[i].style.display = "none";
		}
		tablinks = document.getElementsByClassName("tablinks");
		for (i = 0; i < tablinks.length; i++) {
			tablinks[i].className = tablinks[i].className.replace(" active", "");
		}
		document.getElementById(cityName).style.display = "block";
		evt.currentTarget.className += " active";
	}
	// Get the element with id="defaultOpen" and click on it
	document.getElementById("defaultOpen").click();
	</script>
	</body>
</html>
