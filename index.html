<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
	<title>
		1255 Burgomaster
	</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<style type="text/css">
		/*canvas*/
		.canvas {
			left:0px;
			top:-6px;
			position:relative;
		}
		/*background*/
		.background {
			position:absolute;
			left:0px;
			top:0px;
			z-index:-1;
		}
		/*wall rear*/
		.over1 {
			position:absolute;
			left:0px;
			top:0px;
			z-index:1;
		}
		/*buildings*/
		.over2 {
			position:absolute;
			left:0px;
			top:0px;
			z-index:2;
		}
		/*wall front*/
		.over3 {
			position:absolute;
			left:0px;
			top:0px;
			z-index:3;
		}
		/*fire*/
		.fire {
			position:absolute;
			left:0px;
			top:0px;
			z-index:4;
		}
		.interface {
			position:absolute;
			left:0px;
			top:0px;
			z-index:99;
		}
		.resources{
			position: relative;
			left:0px;
		}
		#defence, #homes, #treasury {
			width: 180px;
		}
		#buttonBldGallows, #buttonBldFountain, #buttonBldStash {
			width: 180px;
		}
		#console_n_chat {
			resize: none;
			overflow: auto;
		}
		/* Style the tab */
		div.tab {
			overflow: hidden;
			border: 1px solid #ccc;

			width: 800px;
			background-color: #f1f1f1;
		}

		/* Style the buttons inside the tab */
		div.tab button {
			background-color: inherit;
			float: left;
			border: none;
			outline: none;
			cursor: pointer;
			padding: 14px 16px;
			transition: 0.3s;
			font-size: 17px;
		}

		/* Change background color of buttons on hover */
		div.tab button:hover {
			background-color: #ddd;
		}

		/* Create an active/current tablink class */
		div.tab button.active {
			background-color: #ccc;
		}

		/* Style the tab content */
		.tabcontent {
			display: none;
			padding: 6px 0px;
			border: 1px solid #ccc;
			border-top: none;
			height: 470px;
			width: 800px;/*800-12*2*/
		}

		/* Style the close button */
		.topright {
			float: right;
			cursor: pointer;
			font-size: 20px;
		}
		.topright:hover {color: red;}
		#lblAboutGame {
			width: 795px;
			height: 475px;
			border: thin solid black;
			overflow:scroll;
			/*
            overflow-x: hidden;
            overflow-y: scroll;
            */
		}
	</style>
	<script id="chatBroEmbedCode">
		/* Chatbro Widget Embed Code Start */
		function ChatbroLoader(chats,async){async=!1!==async;var params={embedChatsParameters:chats instanceof Array?chats:[chats],lang:navigator.language||navigator.userLanguage,needLoadCode:'undefined'==typeof Chatbro,embedParamsVersion:localStorage.embedParamsVersion,chatbroScriptVersion:localStorage.chatbroScriptVersion},xhr=new XMLHttpRequest;xhr.withCredentials=!0,xhr.onload=function(){eval(xhr.responseText)},xhr.onerror=function(){console.error('Chatbro loading error')},xhr.open('GET','//www.chatbro.com/embed.js?'+btoa(unescape(encodeURIComponent(JSON.stringify(params)))),async),xhr.send()}
		/* Chatbro Widget Embed Code End */
		ChatbroLoader({encodedChatId: '1Leg'});
	</script>
</head>
<body>
<span id="html">
		<script>
			var url = window.location.pathname;
			var filename = url.substring(url.lastIndexOf('/')+1);

			if (filename == ""|| filename == "index.html" || filename =="index.htm" || filename =="index.php" || filename == "main2.html" || filename =="main.htm") {
				res_mod = "b";
			}
			else {
				res_mod = "b";
			}
			//alert(res_mod);
			/*
			function reload_res(this) {
			this.src=str.replace(\"_a\", res_mod);
			alert(this.src);
			}
			*/
		</script>
		<div class="tab">
			<button class="tablinks" onclick="openTab(event, 'Main')" id="defaultOpen">Main</button>
			<button class="tablinks" onclick="openTab(event, 'Explore')" style="display:none">Explore</button>
			<button class="tablinks" onclick="openTab(event, 'Settings')">Settings</button>
			<button class="tablinks" onclick="openTab(event, 'Garrison')">Garrison</button>
			<button class="tablinks" onclick="openTab(event, 'Building')">Building</button>
			<button class="tablinks" onclick="openTab(event, 'About')">How To Play</button>
			<button class="tablinks" onclick="openTab(event, 'Discord')">Discord</button>
			<a href="https://www.patreon.com/bePatron?u=7838459" target="_blank"><img src="resources/patreon.png" style="padding: 6px 0px"></a>
		</div>
		<div id="Main" class="tabcontent">
			<canvas width="800" height="480" id="canvas" class="canvas" style="z-index:-1"></canvas>
			<p style="position:absolute; top:60px; left: 20px">
			welcome to heroes' city
			</p>
			<br>
			<p id="resources">
				<span id="gold" class="interface" onclick="game.add_money()" style="position:absolute; top:100px; left:60px">0</span>
				<br>
				<br>
				<span id="pop"  class="interface" style="position:absolute; top:140px; left:60px">2</span>
				<br>
			</p>
			<p id="events_graphics">
			
			</p>
			<!--<img src="resources/fire_a.gif" id="fire_graphics" onclick="putOutFire()" style="position:absolute; top:170px; left:0px; z-index=98; display:none">-->
			<button id="saveGameButton"   onclick="saveGame()" class="interface" style="top:290px; left: 20px">Save game</button>
			<button id="loadGameButton"   onclick="loadGame()" class="interface" style="top:350px; left: 20px">Load game</button>
			<button id="putOutFire"   onclick="game.putOutFire()" class="interface" style="top:390px; left: 20px; display:none">Put out fire</button>
			<button id="buttonDeathPenalty"   onclick="game.deathPenalty()" class="interface" style="top:430px; left: 20px; display:none">Execute smb</button>
			<button id="buttonDebug"   onclick="game.startFire()" class="interface" style="top:190px; left: 20px; display:none">X</button>
			<!--
			<iframe id="constructionWindow" src="construction.html" class="interface" style="left:600px" width="1" height="1"></iframe>
			<button id="constructionButton" onclick="maximizew('construction')" class="interface" style="top:260px">Open construction menu</button>
			-->
		</div>

		<div id="Explore" class="tabcontent" >
			<canvas width="800" height="480" id="canvasMap" class="canvas" style="z-index:-1"></canvas>
			<p style="position:absolute; top:60px; left: 20px">
			GLOBALMAP
			</p>
		</div>

		<div id="Settings" class="tabcontent">
			<!--<span onclick="this.parentElement.style.display='none'" class="topright">x</span>-->
			<h3>Settings</h3>
			<p>Alert / MSG to chat</p>
			<table>
			<tr>
				<td>Autosave <img id="autosaveImg" onclick="changeAutosave()" src="resources/button_red.png"></td>
				<td><button id="buttonExportGame" onclick="exportGame()" >Export Game</button></td>
				<td><button id="buttonImportGame" onclick="importGame()" >Import Game</button></td>
			</tr>



			</table>
			Savestring <input id="savestring" name="savestring" value="" style="width:600px">
			<textarea id="patchnotes" class="interface" value="" style="width:700px; height:300px; top:230px; left:40px"></textarea>

		</div>

		<div id="Garrison" class="tabcontent">
			<!--<span onclick="this.parentElement.style.display='none'" class="topright">x</span>-->
			<h3>Garrison</h3>
			<div id="divtreasuryGuard">
			<table border="1">
				<tr>
					<td>
						<div align="center">
							<img src="resources/knight6.png">
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<button id="fireGuard" onclick="game.fireTreasuryGuard()" style="width:80px">Fire</button>
						<span id="treasuryGuard">0</span>
						<button id="hireGuard" onclick="game.hireTreasuryGuard()" style="width:80px">Hire</button>
						<!--<button id="fireGuard" onclick="fireTreasuryGuard()" class="interface" style="top:170px; left:20px; width:80px">Fire</button>
						<span id="treasuryGuard" class="interface" style="position:absolute; top:170px; left:120px">0</span>
						<button id="hireGuard" onclick="hireTreasuryGuard()" class="interface" style="top:170px; left:180px;-->
					</td>
				</tr>
			</table>
			</div>
		</div>

		<div id="Building" class="tabcontent">
			<!--<span onclick="this.parentElement.style.display='none'" class="topright">x</span>-->
			<h3>Building</h3>
			<div>
				<table border="1">
				<tr>
					<td>
						<div align="center">
							<img id="defencies_img" src="resources/wallsf_as2.png">
						</div>
					</td>
					<td>
						<div align="center">
							<img src="resources/home_as.png">
						</div>
					</td>
					<td>
						<div align="center">
							<img src="resources/treasury_as.png">
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<button id="defence" onclick="game.Build('Wall')">Build walls: 2 gold</button>
					</td>
					<td>
						<button id="homes" onclick="game.Build('Home')">Build home: 2 gold</button>
					</td>
					<td>
						<button id="treasury" onclick="game.Build('Treasury')">Build treasury: 20 gold</button>
					</td>
					<!--
					<button id="defence" onclick="Build('Wall')" class="interface" style="top:170px; left:20px">Build walls: 2 gold</button>
					<button id="homes"   onclick="Build('Home')" class="interface" style="top:210px; left: 20px">Build home: 2 gold</button>
					<button id="treasury" onclick="Build('Treasury')" class="interface" style="top:250px; left:20px">Build treasury: 20 gold</button>-->
				</tr>
				<tr>
					<td>
						<div align="center">
							<img src="resources/gallows.png">
						</div>
					</td>
					<td>
						<div align="center">
							<img src="resources/fountain.png">
						</div>
					</td>
					<td>
						<div align="center">
							<img src="resources/trapdoor.png">
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<button id="buttonBldGallows" onclick="game.Build('Gallows')">Build gallows: 50 gold</button>
					</td>
					<td>
						<button id="buttonBldFountain" onclick="game.Build('Fountain')">Build fountain: 50 gold</button>
					</td>
					<td>
						<button id="buttonBldStash" onclick="game.Build('Stash')">Build stash: 50 gold</button>
					</td>
				</tr>
			</table>
			</div>
		</div>

		<div id="About" class="tabcontent">
			<div id="lblAboutGame">
			<h1>1255 Burgomaster</h1><br>
			<h2>How to play</h2>
			This game has some tick under the hood. Each tick happens in 30 seconds.<br>
			After each turn your poplulation paid taxes to you and growing.<br>
			You need to build homes to continue growth your city population.<br>
			Each lvl of houses allows you to have more population.<br>
			You need to build walls and tower (keep) to keep your city safe against intruders.<br>
			You need to build a treasury to store your gold.<br>
			Each lvl of the treasury allows you to keep more gold.<br>
			Also, Treasury allows you to hire treasury guads.<br>
			Treasury guards signifant decreases chance of stealing gold from your treasury.<br>
			Hiring the guard will cost you 20 gold.<br>
			Each guard require regular payment (each tick), it also cost 20 gold.<br>
			If you don't have enough money, they will leave their work permamently.<br>
			You can build fountain OR gallows. You can't change your choice after building is done.<br>
			Fountains will increase happiness and speed of growing population.<br>
			Gallows will decrease population, increase taxes, and allow you to execute townsfolk.<br>
			Executing any townperson will add his property as confiscated gold.<br>
			Stash is required to lower your losses from stealing. You can't build stash without treasury.<br>
			<br>
			<h2>Minimum System Requirements</h2>
			Browsers:<br>
			Internet Explorer 10, Internet Explorer Mobile 10<br>
			Mozilla Firefox 3.6, Firefox Android All<br>
			Google Chrome 4, Chrome Android All<br>
			Safari 4, iOS Safari 3.2<br>
			Opera 11, Opera Mobile 12*<br>
			Android 3, Chrome Android, <br>
			Blackberry Browser 7<br>
			*Please note, Opera Mini is NOT SUPPORTED!<br>
			Data about Browser support provided by <a href="https://caniuse.com/">https://caniuse.com/</a> service<br>
			<br>
			512MB RAM<br>
			600MHz 1 Core CPU<br>
			1MB of data plan to download game itself, analytics and chat. And some traffic will be used with ingame chat and usage statistics, though game will works perfectly even offline after download complete* (check options offline game)<br>
			<br>
			<h2>About the project</h2><br>
			Hello there! My name is Gladyshev Anton and I'm the author of the project.<br>
			Homepage of the project is <a href="https://github.com/Areso/1255-burgomaster">https://github.com/Areso/1255-burgomaster</a><br>
			This pet-project is dedicated to create a playable game, written in vanilla JavaScript,
			without using jQuery and modern whistlers and jugglers.<br>
			The project oriented to be compact (in terms of source code and resources),
			blazing fast to download, fast enough to run even on aging devices with limited horsepower under the hood.<br>
			It runs well even on low-powered tablets and phones, let alone old PCs and laptops<br>
			It heavily uses JS technologies as HTML5.Canvas, EcmaScript5 localStorage, <span style="color:red">JSON.parse()</span>, and so on.
			<br>
			<h2>About the game</h2>
			The game itself about building a city. You are starting with some amount of gold and a few citizens.<br>
			This is an IDLE game, which means, every minute your citizens will spawn new citizens and pay taxes to you.<br>
			You can constuct buildings, but upgrading existing ones will require each time more gold, because this game is an Incremental game.<br>
			As for now, constructing building do not requires time, only resources.<br>
			Straight management, which means, you need place management by clicking here and there and you will get what you clicked.</br>
				<div style="color:red">You will explore wild territories near your city.</div><br>
			Regarding you choices, you could get boost in taxes or birthrate, happynness and so on.<br>
			Game could become to a Clicker game in case you build Gallows and like to execute you citizens.<br>
			This game created and new features right now in development inspiring by Travian, Townsmen, Stronghold and Stronghold Crusaders, HoMM (Heroes of Might and Magic), Lord of Realm, Anno series.<br>
			You can export and import game to transfer your progress between different browsers and PCs.<br>
			For keeping you tuned, you will get handful of unfortunate or, on the contrary, fortunate events:<br>
			<ul>
			 <li>thieves will steal your gold,</li>
			 <li><div style="color:red">aggressive neighbors will attack your city,</div></li>
			 <li><div style="color:red">flood and drought will kill your crops,</div></li>
			 <li><div style="color:red">mouses and rats will devastate your barns,</div></li>
			 <li>fires will destroy your buildings*,</li>
			 <li>and I will add more events</li>
			</ul>
			<br>
			Colors meaning: red - not yet implemented, but planned to implement<br>
			*Sadly, this event turned off due to instability of his work. I hope it temporary<br>
			All suggestion and bug reports could be made via chat (if enabled) or via <a href="https://github.com/Areso/1255-burgomaster/issues">GitHub Issues</a></br>
		</div>
		</div>

		<div id="Discord" class="tabcontent">
			<iframe src="https://discordapp.com/widget?id=564554640755130409&theme=light" width="800" height="470" allowtransparency="true" frameborder="0"></iframe>
		</div>
		<p id="console_n_chat_div" style="top:530px; left:10px" class="interface">
		<textarea id="console_n_chat" name="console_n_chat" class="interface" value="" style="width:800px"></textarea>
		</p>
		</span>
<script>
	//TOWN
	var canvas  = document.getElementById("canvas");
	var ctx     = canvas.getContext("2d");

	var img1    = loadImage('resources/background_a.png', composite);//use forward slashes for Linux and Windows compatible. \ this slash works only in Windows.
	var img2    = loadImage('resources/sawmill_a.png', composite);
	var img3    = loadImage('resources/gold_a.png', composite);
	var img4    = loadImage('resources/pop_a.png', composite);
	var img5    = loadImage('resources/home_a.png', composite);
	var img5_1  = loadImage('resources/house_a.png', composite);
	var img6_1  = loadImage('resources/wallsr_a.png', composite);
	var img6_2  = loadImage('resources/wallsf_a.png', composite);
	var img7    = loadImage('resources/castle_as.png', composite);
	var img8    = loadImage('resources/wishing_well_builded.png', composite);
	var img9    = loadImage('resources/treasury.png', composite);
	var img10   = loadImage('resources/gallows.png', composite);
	var img11   = loadImage('resources/fountain.png', composite);
	var img12   = loadImage('resources/trapdoor.png', composite);

	var Singleton = (function () {
		var instance;
		function createInstance() {
			var object = loadImage('resources/fire_static.png', composite);
			return object;
		}
		return {
			getInstance: function () {
				if (!instance) {
					instance = createInstance();
				}
				return instance;
			}
		};
	})();
	var imagesLoaded = 0;
	function composite() {
		imagesLoaded = imagesLoaded*1 + 1;
		if (imagesLoaded > 1) {
			// composite now
			//ctx.globalAlpha = 1.00;
			ctx.drawImage(img1, 0, 0);   //draw background
			ctx.drawImage(img2, 0, 0);   //draw sawmill
			ctx.drawImage(img3, 10, 40); //draw gold icon
			ctx.drawImage(img4, 10, 80); //draw pop  icon
			ctx.drawImage(img8, 0, 0); //draw wishing well
			if (game.buildLevelD > 0) {
				// draw back piece of wall
				ctx.drawImage(img6_1, 0, 0);
			}
			if (game.buildLevelH > 0 && game.buildLevelH < 10) {
				// draw houses
				ctx.drawImage(img5, 0, 0);
			}
			if (game.buildLevelH >= 10) {
				// draw more houses
				ctx.drawImage(img5_1, 0, 0);
			}
			if (game.buildLevelD > 1) {
				// draw castle
				ctx.drawImage(img7, 300, 160);
			}
			if (game.buildLevelD > 0) {
				// draw front piece of wall
				ctx.drawImage(img6_2, 0, 0);
			}
			if (game.buildLevelTreasury > 0) {
				// draw treasury
				ctx.drawImage(img9, 0, 0);
			}
			if (game.buildLevelGallows > 0) {
				// draw gallows
				ctx.drawImage(img10, 460, 270);
			}
			if (game.buildLevelFountain > 0) {
				// draw fountain
				ctx.drawImage(img11, 460, 270);
			}
			if (game.buildLevelStash > 0) {
				// draw stash
				//We do not draw a secret Stash under the Treasury. It's a secret, are you understand?!
				//ctx.drawImage(img12, 0, 0);
			}
			if (game.fire === 1) {
				var img13 = Singleton.getInstance();
				objFire_graphics         = new Image();
				objFire_graphics.id      = "fire_graphics";
				objFire_graphics.src     = 'resources/fire_a.gif';
				objFire_graphics.style   = 'position:absolute; top:170px; left:0px; z-index=98; display:none'
				//objFire_graphics.onclick = putOutFire();
				document.getElementById("events_graphics").appendChild(objFire_graphics);
				//originalDiv.parentNode.insertBefore(newVideo, originalDiv);
				//document.body.insertBefore(fire_graphics, pp);
				document.getElementById("fire_graphics").setAttribute("onclick", "game.putOutFire()");
				document.getElementById("putOutFire").setAttribute("style", "top:390px; left: 20px; display:true");
				document.getElementById("fire_graphics").setAttribute("style", "position:absolute; top:170px; left:0px; z-index=98; display:true");
			}
		}
	}
	function loadImage(src, onload) {
		var img = new Image();
		img.onload = onload;
		img.src = src;
		return img;
	}
	//composite();
</script>
<script>

	//GLOBALMAP
	var canvas_map      = document.getElementById("canvasMap");
	var ctx_map         = canvas_map.getContext("2d");
	var tile_grass      = loadImage('tiles/grass.png', composite_gm);//use forward slashes for Linux and Windows compatible. \ this slash works only in Windows.
	var tile_sand       = loadImage('tiles/sand.png', composite_gm);
	var tile_snow       = loadImage('tiles/snow.png', composite_gm);
	var tile_water      = loadImage('tiles/water.png', composite_gm);

	var imagesLoadedMap = 0;

	function composite_gm() {
		imagesLoadedMap = imagesLoadedMap*1 + 1;
		if (imagesLoadedMap > 1) {
			// composite now
			//ctx.globalAlpha = 1.00;
			for (i = 0; i < 4; i++) {
				for (j = 0; j < 4; j++) {
					globalMap[0][0] = 1;
				}
			}
			ctx_map.drawImage(tile_grass, 0, 0);   //draw background
		}
	}
	/*
    function loadImage(src, onload) {
        var img = new Image();
        img.onload = onload;
        img.src = src;
        return img;
    }
    */
</script>
<script>
    include = function (url, fn) {
        var e = document.createElement("script");
        e.onload = fn;
        e.src = url;
        e.async=true;
        document.getElementsByTagName("head")[0].appendChild(e);
    };
	//init variables
	var game = {
		gold:20,
		pop:2,
		period:2, //1 - Winter, 2 - Spring, 3 - Summer, 4 - Autumn
		year:1255,
		food:20,
		treasuryGuard:0,
		buildLevelD:0,
		buildLevelH:0,
		buildLevelTreasury:0,
		buildLevelGallows:0,
		buildLevelFountain:0,
		buildLevelStash:0,
		fire:0,
		happyness:80,
		o_autosave:0,
		saveVersion:"saveV1004",
		goldLimit : function () {
			return Math.pow(config.costTreasury,(game.buildLevelTreasury*1+1))*2+500;
		},
		calculateTurn : function() {
			pop_m         = 0;
			pop_was       = game.pop;
			game.period   = game.period + 1;
			gold_was      = game.gold;
			gold_limit    = game.goldLimit();
			gold_possible = game.gold*1+Math.round(game.pop*(1+game.buildLevelGallows*1/10),0);
			if (gold_possible > gold_limit) {
				game.gold      = gold_limit;
				msg = localeStrings[3];
				postEventLog(msg);
			} else {
				game.gold      = gold_possible;
			}
			//gold     = gold*1+2;
			if (game.pop < 2*Math.pow((game.buildLevelH*1+3),2)) {
				pop_incr = Math.round((game.pop*20/1000)*(1+game.buildLevelFountain*1/10),0)
				if (pop_incr == 0) {
					game.pop = game.pop*1+1;
				} else {
					game.pop = game.pop*1+pop_incr*1;
				}
				pop_m    = 1;
			} else {
				postEventLog(localeStrings[10]);
			}
			if (game.treasuryGuard > 0) {
				if (game.gold - game.treasuryGuard * config.treasuryGuardPricePayroll >= 0) {
					game.gold = game.gold - game.treasuryGuard * config.treasuryGuardPricePayroll;
				}
				else {
					//fire guards which we cannot afford
					//for now fire all guards!//TODO fire only those who we cannot afford
					game.treasuryGuard = 0;
					msg   = "treasury guard(s) were fired because you are cannot pay to them!";
					postEventLog(msg);
				}
			}
			if (game.gold !== gold_was) {
                if (game.gold > gold_was) {
                    msg = localeStrings[4];
                } else {
                    msg = localeStrings[5];
                }
                postEventLog(msg);
            };
            if (game.pop !== pop_was) {
                if (game.pop > pop_was) {
                    msg = localeStrings[7];
                } else {
                    msg = localeStrings[8];
                }
                postEventLog(msg);
            };
    		updateResources();
		},
		Build : function (Structure) {
			if (Structure==="Wall" || Structure ==="Tower") {
				if (game.gold >= config.costWall && game.buildLevelD == 0) {
					game.buildLevelD        = game.buildLevelD*1 + 1;
					game.gold               = game.gold - config.costWall;
					commonBuild();
					return true;
				}
				if (game.gold >= config.costTower && game.buildLevelD == 1) {
					game.buildLevelD        = game.buildLevelD*1 + 1;
					game.gold               = game.gold - config.costTower;
					commonBuild();
					return true;
				}
			}
			if (Structure==="Home") {
				if (game.gold >= Math.pow(config.costHome,(game.buildLevelH*1 + 1))) {
					game.gold               = game.gold - Math.pow(config.costHome,(game.buildLevelH*1 + 1));
					game.buildLevelH        = game.buildLevelH*1 + 1;
					commonBuild();
					return true;
				}
			}
			if (Structure==="Treasury") {
				if (game.gold >= Math.pow(config.costTreasury,(game.buildLevelTreasury*1 + 1))) {
					game.gold               = game.gold - Math.pow(config.costTreasury,(game.buildLevelTreasury*1 + 1));
					game.buildLevelTreasury = game.buildLevelTreasury*1 + 1;
					commonBuild();
					return true;
				}
			}
			if (Structure==="Gallows") {
				if (game.gold >= Math.pow(config.costGallows,(game.buildLevelGallows*1 + 1)) && game.buildLevelFountain == 0) {
					game.gold               = game.gold - Math.pow(config.costGallows,(game.buildLevelGallows*1 + 1));
					game.buildLevelGallows  = game.buildLevelGallows*1 + 1;
					commonBuild();
					return true;
				}
			}
			if (Structure==="Fountain") {
				if (game.gold >= Math.pow(config.costFountain,(game.buildLevelFountain*1 + 1)) && game.buildLevelGallows == 0) {
					game.gold               = game.gold - Math.pow(config.costFountain,(game.buildLevelFountain*1 + 1));
					game.buildLevelFountain = game.buildLevelFountain*1 + 1;
					commonBuild();
					return true;
				}
			}
			if (Structure==="Stash") {
				if (game.gold >= Math.pow(config.costStash,(game.buildLevelStash*1 + 1)) && game.buildLevelTreasury*1 > 0) {
					game.gold               = game.gold - Math.pow(config.costStash,(game.buildLevelStash*1 + 1));
					game.buildLevelStash    = game.buildLevelStash*1 + 1;
					commonBuild();
					return true;
				}
			}
			function commonBuild() {
				updateResources();
				composite();
				updateButtonCaptions();
			}
		},
		hireTreasuryGuard : function () {
			if (game.buildLevelTreasury >= 1) {
				question = "Hire a guardman? It will cost you 20 gold per tick!";
				var answer = askPlayer(question, 1);
				if (answer === true) {
					if (game.gold >= config.treasuryGuardPriceHire) {
						game.treasuryGuard = game.treasuryGuard*1 + 1;
						game.gold          = game.gold - config.treasuryGuardPriceHire;
						//document.getElementById("guardmen").setAttribute("style", "position:absolute; top:200px; left:200px; z-index=100; display:true");
						msg = "You have hired a guardman!";
						postEventLog(msg);
						updateResources();
					}
					else {
						msg = "We need more gold to do that!";
						postEventLog(msg);
					}
				}
			} else {
				alert('You don\'t have a treasury to hire a treasury guard!');
			}
		},
		fireTreasuryGuard : function () {
			if (game.treasuryGuard > 0) {
				question = "Fire a guardman?";
				var answer = askPlayer(question, 1);
				if (answer === true) {
					game.treasuryGuard      = game.treasuryGuard*1 - 1;
					msg = "You have fired a guardman!";
					postEventLog(msg);
					updateResources();
				}
			} else {
				msg = "You don't have any guardsmen!";
				postEventLog(msg);
			}
		},
		deathPenalty : function () {
			if (game.buildLevelGallows > 0) {
				if (game.pop > 2) {
					game.pop      = game.pop - 1;
					gold_was      = game.gold;
					gold_limit    = game.goldLimit();
					gold_possible = game.gold*1+Math.floor((Math.random() * game.gold)/10 + 1);
					if (gold_possible > gold_limit) {
						game.gold = gold_limit;
						msg = "build or update Treasury";
						postEventLog(msg);
					} else {
						game.gold = gold_possible;
					}
					gold_incr     = game.gold - gold_was;
					rnd = Math.floor((Math.random() * 6) + 1);
					//rnd = 1;//debug
					switch (rnd) {
						case 1:
							reason = "treachery";
							break;
						case 2:
							reason = "betroyal";
							break;
						case 3:
							reason = "corruption";
							break;
						case 4:
							reason = "bribery";
							break;
						case 5:
							reason = "graft and theft";
							break;
						case 6:
							reason = "embezzlement"
							break;
						default:
							alert("error on switch/case function");
					}
					msg = "you executed a townperson for "+reason;
					postEventLog(msg);
					msg = "your treasury funded on "+gold_incr+" as confiscated property";
					postEventLog(msg);
				}
				updateResources();
			}
		},
		putOutFire : function () {
			if (game.fire === 1) {
				question = "Call an fireman? It will cost you 20 gold!";
				var answer = askPlayer(question, 1);
				if (answer === true) {
					if (game.gold >= 20) {
						game.fire = 0;
						game.gold = game.gold - 20;
						document.getElementById("fire_graphics").setAttribute("style", "position:absolute; top:200px; left:200px; z-index=100; display:none");
						document.getElementById("putOutFire").setAttribute("style", "top:390px; left: 20px; display:none");
						msg = "Fireman put out a fire!";
						postEventLog(msg);
						updateResources();
					}
					else {
						msg = "We need more gold to do that!";
						postEventLog(msg);
					}
				}
				else {
					msg = "It will burn to ashes!";
					postEventLog(msg);
				}
			}
		},
		theftFromTreasury : function () {
			rndThieves = Math.floor((Math.random() * treasuryGuard) + 1);
			if (rndThieves === 1) {
				goldLost      = Math.floor(Math.random() * (game.gold/(1+game.buildLevelStash))+1);
				game.gold     = game.gold - goldLost;
				msg = "shit happens: thieves stole "+goldLost+" gold from your treasury";
				postEventLog(msg);
				updateResources();
			}
		},
		startFire : function () {
			if (game.fire === 0) {
				msg = "fire in the city!";
				postEventLog(msg);
				game.fire = 1;
				composite();
				if (game.buildLevelD == 1) {
					ceil = 1
				}
				if (game.buildLevelD == 2) {
					ceil = 2
				}
				rnd = Math.floor((Math.random() * 2) + 0);
				if (rnd === 0) {
					//	document.getElementById('constructions').innerHTML = document.getElementById('constructions').innerHTML+fire;
				}
				if (rnd === 1) {
					//	document.getElementById('constructions').innerHTML = document.getElementById('constructions').innerHTML+fire;
				}
				if (rnd === 0) {
					//	document.getElementById('constructions').innerHTML = document.getElementById('constructions').innerHTML+fire;
				}
			}
		},
		winLottery : function () {
			msg = "You won a lottery with "+config.lotteryPrize+" gold prize";
			postEventLog(msg);
			game.gold = game.gold + config.lotteryPrize;
			updateResources();
		}
	};
	//init const-variables
	var config = {
		costWall:2,
		costTower:4,
		costHome:2,
		costTreasury:20,
		costGallows:50,
		costFountain:50,
		costStash:50,
		lotteryPrize:50,
		treasuryGuardPriceHire:20,
		treasuryGuardPricePayroll:20,
	}
	//init service variables
	var csum          = 0;
	var delimiter     = ";"
	var redraw        = 0;
	var whatDraw      = "";
	var minBL         = 0;
	var mapCreated    = 0;
	var globalMap = [[],[]];
	updateResources();
	populatePatchnotes();
	generateMap();
	var autosaveObject;
	setupAutosave();//DEBUG
	//init timers
	setInterval(resourcesTimer, 30000);
	setInterval(rndEvents, 100000);

    include('localisation.js',function(){
        //document.getElementById('lblPlayGame').innerHTML=localeStrings[0];
        loadStartLocale();
        //setTimeout(welcomeMsg, 500);
        console.log('we are in first level include after loadStartLocale()');
    });

	//functions
    function localeCallback() {
        welcomeMsg();
    }
	function welcomeMsg(){
		postEventLog(localeStrings[0]);
		postEventLog(localeStrings[1]);
		postEventLog(localeStrings[2]);
	}
	function postEventLog(msgEventLog) {
		document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+msgEventLog;
		scrollDown();
	}
	function generateMap() {
		/*
        var arr  = [];

        var arr1 = ['00','01'];
        var arr2 = ['10','11'];
        var arr3 = ['20','21'];
        for (j = 0; j < 2; j++) {
                arr1.push(Math.floor(Math.random()*10);
            }
        arr.push(arr1);
        arr.push(arr2);
        arr.push(arr3);
        for (i = 0; i < 4; i++) {
            for (j = 0; j < 4; j++) {
                globalMap[0][0] = 1;
            }
        }
        */
		for (var a=[]; a.push([])<10;);
		for (i = 0; i < 4; i++) {
			for (j = 0; j < 4; j++) {
				a[i][j] = Math.floor(Math.random()*10);
				//console.log("i "+i+" and j is "+j+" value is "+a[i][j]);
			}
		}
		mapCreated = 1;
	}
	function populatePatchnotes() {
		msg = "version 1.0.180";
		writeToTextArea(msg);
		msg = "clean mess with version numeration. somewhat";
		writeToTextArea(msg);

		msg = "version 1.0.179";
		writeToTextArea(msg);
		msg = "fixed a bug with lottey. Added Discord widget. Added periods counter";
		writeToTextArea(msg);

		msg = "version 1.0.178";
		writeToTextArea(msg);
		msg = "a few minor labels\' corrections";
		writeToTextArea(msg);

		msg = "version 1.0.177";
		writeToTextArea(msg);
		msg = "fixed bug with About tab";
		writeToTextArea(msg);

		msg = "version 1.0.176";
		writeToTextArea(msg);
		msg = "due to the author\'s error, the version now is 1.0.175. Do not git push with --force!";
		writeToTextArea(msg);

		msg = "version 1.0.125";
		writeToTextArea(msg);
		msg = "fixed the bug, then player can't afford treasury upgrade and it's already full";
		writeToTextArea(msg);
		msg = "renamed About to How to Play";
		writeToTextArea(msg);

		msg = "version 1.0.124";
		writeToTextArea(msg);
		msg = "finnally, my game running by the object under the hood";
		writeToTextArea(msg);

		msg = "version 1.0.124";
		writeToTextArea(msg);
		msg = "finnaly, my game running by the object under the hood";
		writeToTextArea(msg);

		msg = "version 1.0.102";
		writeToTextArea(msg);
		msg = "added tab About game"+"\n"+
				"thus close #107";
		writeToTextArea(msg);

		msg = "version 1.0.99";
		writeToTextArea(msg);
		msg = "added Yandex Metrica"+"\n"+
				"fix #105 close #103 #70 #102 #85 #101 ";
		writeToTextArea(msg);

		msg = "version 1.0.95";
		writeToTextArea(msg);
		msg = "added Google analytics. Tuned gold limit";
		writeToTextArea(msg);

		msg = "version 1.0.94";
		writeToTextArea(msg);
		msg = "treasury limit now fixed from bug (close #80)";
		writeToTextArea(msg);

		msg = "version 1.0.93";
		writeToTextArea(msg);
		msg = "another bug with stash/treasury loading from save";
		writeToTextArea(msg);

		msg = "version 1.0.92";
		writeToTextArea(msg);
		msg = "another bug with fire in the city";
		writeToTextArea(msg);

		msg = "version 1.0.91";
		writeToTextArea(msg);
		msg = "compress resources close #73, tried singleton (hope it work), and fix #75";
		writeToTextArea(msg);

		msg = "version 1.0.89";
		writeToTextArea(msg);
		msg = "now with shiny messages in chat about execution";
		writeToTextArea(msg);

		msg = "version 1.0.88";
		writeToTextArea(msg);
		msg = "execution button";
		writeToTextArea(msg);

		msg = "version 1.0.87";
		writeToTextArea(msg);
		msg = "set build buttons invisible for Gallows-Fountain when Fountain-Gallows is built";
		writeToTextArea(msg);

		msg = "version 1.0.79";
		writeToTextArea(msg);
		msg = "gallows prevent building fountain, fountain prevent building gallows and stash requires treasury";
		writeToTextArea(msg);

		msg = "version 1.0.78";
		writeToTextArea(msg);
		msg = "bugfix #34 Autosave now implemented"+"\n"+
				"bugfix #59 new variables don't brick old saves";
		writeToTextArea(msg);

		msg = "version 1.0.76";
		writeToTextArea(msg);
		msg = "bugfix #39 Save/Load doesn't apply on fire in the city"+"\n"+
				"bugfix #42 Prevent load game if there no saves around"+"\n"+
				"bugfix #51 Save and Load with confirmation"+"\n"+
				"bugfix #54 Hiring treasury guards available only if treasury is built"+"\n"+
				"close #55 Added image of treasury guard";
		writeToTextArea(msg);

		msg = "version 1.0.72";
		writeToTextArea(msg);
		msg = "bugfix #29, #47, #48. No defence button after load"
		writeToTextArea(msg);

		msg = "version 1.0.70";
		writeToTextArea(msg);
		msg = "bugfix #44. Now it indicates if gold increased, decreased or not changed"
		writeToTextArea(msg);

		msg = "version 1.0.69";
		writeToTextArea(msg);
		msg = "bugfix #43 (word 'gold' appears after variable, when thieves stole some gold. fix #40"
		writeToTextArea(msg);

		msg = "version 1.0.68";
		writeToTextArea(msg);
		msg = "Bug fixes #35";
		writeToTextArea(msg);

		msg = "version 1.0.66";
		writeToTextArea(msg);
		msg = "You now can fire guardsmen"
		writeToTextArea(msg);

		msg = "version 1.0.65";
		writeToTextArea(msg);
		msg = "Bug fix #30. You're need to hire your treasury guards again, because save file is partially broken"
		writeToTextArea(msg);

		msg = "version 1.0.64";
		writeToTextArea(msg);
		msg = "Added new tab 'Building'. All building buttons move to 'Building' tab. Added firing procedure for treasury guardsmen (not only hiring for now). Added treasury building. As for now it does nothing, but it exists now."
		writeToTextArea(msg);
	}
	function writeToTextArea(msg) {
		document.getElementById("patchnotes").value = document.getElementById("patchnotes").value+"\r\n"+msg;
	}
	function setupAutosave() {
		if (game.o_autosave==0) {
			if (typeof autosaveObject !== 'undefined') {
				clearInterval(autosaveObject);
			}
			//alert("Autosave disabled");
			document.getElementById("autosaveImg").setAttribute("src","resources/button_red.png");
		} else {
			autosaveObject = setInterval(autosaveGame, 40000);
			//alert("Autosave enabled");
			document.getElementById("autosaveImg").setAttribute("src","resources/button_green.png");
		}
	}
	function changeAutosave() {
		if (game.o_autosave==0) {
			game.o_autosave = 1;
			setupAutosave();
		} else {
			game.o_autosave = 0;
			setupAutosave();
		}
	}
	function autosaveGame() {
		//alert("saved");
		saveGame("silent");
	}
	function exportGame() {
		stringSavegame = JSON.stringify(game);
		//stringSavegame = stringSavegame+delimiter+JSON.stringify(options);
		//add csum (control sum of game)
		document.getElementById("savestring").value = btoa(stringSavegame);
	}
	function importGame() {
		save64 = prompt(localeStrings[16],localeStrings[17]);
		if (save64 != null) {
			try {
				saveLine  = atob(save64);
				saveArray = saveLine.split(delimiter);

				gameTemp  = JSON.parse(saveArray[0]);
				for (var propertyName in gameTemp) { game[propertyName] = gameTemp[propertyName]; }
				//options   = JSON.parse(saveArray[1]);
				setupAutosave();
				composite();
				updateResources();
				updateButtonCaptions();
				document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+localeStrings[12];
				scrollDown();

				//TODO
				//} else {
				//	alert ("save file was modified. Too bad");
				//}
			}
			catch(err) {
				console.log(err);
			}
		}
	}
	function saveGame(saveConfirmation) {
		if (saveConfirmation=="silent") {
			writeSave();
		} else {
			question = localeStrings[15];
			var answer = askPlayer(question, 1);
			if (answer === true) {
				writeSave();
			}
		}
	}
	function writeSave(){
		localStorage.setItem('game', JSON.stringify(game));
		localStorage.setItem('config', JSON.stringify(options));
		document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+localeStrings[11];
		scrollDown();
	}
	function loadGame() {
		question = localeStrings[13];
		var answer = askPlayer(question, 1);
		if (answer === true) {
			if (localStorage.getItem('game')!=null){
				//Object.assign(game, JSON.parse(localStorage.getItem('game')));//DOESN'T WORK IN IE AT ALL.
				gameTemp = JSON.parse(localStorage.getItem('game'));
				for (var propertyName in gameTemp) { game[propertyName] = gameTemp[propertyName]; }
				options  = JSON.parse(localStorage.getItem('options'));
				setupAutosave();
				composite();
				updateResources();
				updateButtonCaptions();
				document.getElementById("console_n_chat").value = document.getElementById("console_n_chat").value+"\r\n"+getTime(0)+": "+localeStrings[12];
				scrollDown();
			} else {
			    //TODO DO NOT SHOW loadGame BUTTON UNTIL WE DO HAVE A SAVEGAME!!!!
				alert(localeStrings[14]);
			}
		}
	}
	function updateButtonCaptions(){
		nextLvlHome           = game.buildLevelH*1+1;
		nextLvlPriceHome      = Math.pow(config.costHome,(game.buildLevelH*1+1));
		document.getElementById("homes").innerHTML="Build home lvl"+nextLvlHome+"; "+nextLvlPriceHome+" gold";

		nextLvlTreasury       = game.buildLevelTreasury*1+1;
		nextLvlPriceTreasury  = Math.pow(config.costTreasury,(game.buildLevelTreasury*1+1));
		document.getElementById("treasury").innerHTML="Build treasury lvl"+nextLvlTreasury+"; "+nextLvlPriceTreasury+" gold";

		nextLvlGallows        = game.buildLevelGallows*1+1;
		nextLvlPriceGallows   = Math.pow(config.costGallows,(game.buildLevelGallows*1+1));
		document.getElementById("buttonBldGallows").innerHTML="Build gallows lvl"+nextLvlGallows+"; "+nextLvlPriceGallows+" gold";

		nextLvlFountain       = game.buildLevelFountain*1+1;
		nextLvlPriceFountain  = Math.pow(config.costFountain,(game.buildLevelFountain*1+1));
		document.getElementById("buttonBldFountain").innerHTML="Build fountain lvl"+nextLvlFountain+"; "+nextLvlPriceFountain+" gold";

		nextLvlStash          = game.buildLevelStash*1+1;
		nextLvlPriceStash     = Math.pow(config.costStash,(game.buildLevelStash*1+1));
		document.getElementById("buttonBldStash").innerHTML="Build stash lvl"+nextLvlStash+"; "+nextLvlPriceStash+" gold";

		if (game.buildLevelD == 1) {
			document.getElementById("defence").innerHTML="Build Tower: "+config.costTower+" gold";
			var towerClick = "game.Build("+"\'Tower\'"+")";
			document.getElementById("defence").setAttribute("onclick", towerClick);
		}
		if (game.buildLevelD == 2) {
			document.getElementById("defence").setAttribute("style", "display:none");
		}
		if (game.buildLevelFountain > 0) {
			document.getElementById("buttonBldGallows").setAttribute("style", "display:none");
		}
		if (game.buildLevelGallows > 0) {
			document.getElementById("buttonBldFountain").setAttribute("style", "display:none");
			document.getElementById("buttonDeathPenalty").setAttribute("style", "top:430px; left: 20px");
		}
	}
	function getTime(type) {
		var d = new Date();
		var hh = d.getHours();
		var mm = d.getMinutes();
		var ss = d.getSeconds();
		if (hh < 10) {
			hh = "0"+hh;
		}
		if (mm < 10) {
			mm = "0"+mm;
		}
		if (ss < 10) {
			ss = "0"+ss;
		}
		if (type=="0") {
			n = hh+":"+mm;
		}
		if (type=="1") {
			n = hh+":"+mm+":"+ss;
		}
		return n;
	}
	function scrollDown(){
		var textarea = document.getElementById("console_n_chat");
		if(textarea.selectionStart === textarea.selectionEnd) {
			textarea.scrollTop = textarea.scrollHeight;
		}
	}
	function updateResources() {
		document.getElementById("gold").innerHTML          = game.gold;
		document.getElementById("pop").innerHTML           = game.pop;
		document.getElementById("treasuryGuard").innerHTML = game.treasuryGuard;
	}
	function updateImagesBuildingTab () {
		//TODO
	}
	function askPlayer(question, typeofasking) {
		if (typeofasking === 1) {
			playerDecision = confirm(question);
		}
		return playerDecision;
	}
	//timers
	function resourcesTimer() {
		game.calculateTurn();
	}
	function rndEvents() {
		rnd = Math.floor((Math.random() * 12) + 1);
		//rnd = 2;//debug
		switch (rnd) {
			case 1:
				game.theftFromTreasury();
				break;
			case 2:
				game.startFire();
				break;
			case 3:
				//
				break;
			case 4:
				//
				break;
			case 5:
				//
				break;
			case 6:
				//
				break;
			case 7:
				//
				break;
			case 8:
				//
				break;
			case 9:
				//
				break;
			case 10:
				//
				break;
			case 11:
				//
				break;
			case 12:
				game.winLottery();
				break;
			default:
				alert("error on switch/case function");
		}
	}
</script>
<script>
	function openTab(evt, tabName) {
		var i, tabcontent, tablinks;
		tabcontent = document.getElementsByClassName("tabcontent");
		for (i = 0; i < tabcontent.length; i++) {
			tabcontent[i].style.display = "none";
		}
		tablinks = document.getElementsByClassName("tablinks");
		for (i = 0; i < tablinks.length; i++) {
			tablinks[i].className = tablinks[i].className.replace(" active", "");
		}
		document.getElementById(tabName).style.display = "block";
		evt.currentTarget.className += " active";
	}
	// Get the element with id="defaultOpen" and click on it
	document.getElementById("defaultOpen").click();
</script>
<!--<script src="localisation.js"></script>-->
<!--Google Analytics. Sorry guys and girls, but I need some analytic from the game. Feel free to block it -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-111661515-1"></script>
<script async>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'UA-111661515-1');
</script>
<!-- Yandex.Metrika counter. The same -->
<script type="text/javascript" >
	(function (d, w, c) {
		(w[c] = w[c] || []).push(function() {
			try {
				w.yaCounter47225574 = new Ya.Metrika({
					id:47225574,
					clickmap:true,
					trackLinks:true,
					accurateTrackBounce:true,
					webvisor:true
				});
			} catch(e) { }
		});

		var n = d.getElementsByTagName("script")[0],
				s = d.createElement("script"),
				f = function () { n.parentNode.insertBefore(s, n); };
		s.type = "text/javascript";
		s.async = true;
		s.src = "https://mc.yandex.ru/metrika/watch.js";

		if (w.opera == "[object Opera]") {
			d.addEventListener("DOMContentLoaded", f, false);
		} else { f(); }
	})(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/47225574" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
</body>
</html>
